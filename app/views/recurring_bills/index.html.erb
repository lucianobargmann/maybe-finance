<div class="pb-12">
  <%= render "recurring_bills/header", month: @month %>

  <%= turbo_frame_tag "bill_summary" do %>
    <%= render "recurring_bills/summary", summary: @summary, month: @month %>
  <% end %>

  <% if @alerts[:overdue].any? || @alerts[:due_today].any? || @alerts[:due_soon].any? %>
    <div class="mb-6 space-y-2">
      <% @alerts[:overdue].each do |payment| %>
        <%= render DS::Alert.new(
          message: t(".alerts.overdue_message", name: payment.recurring_bill.name, date: l(payment.due_date, format: :short)),
          variant: :error
        ) %>
      <% end %>
      <% @alerts[:due_today].each do |payment| %>
        <%= render DS::Alert.new(
          message: t(".alerts.due_today_message", name: payment.recurring_bill.name),
          variant: :error
        ) %>
      <% end %>
      <% @alerts[:due_soon].each do |payment| %>
        <%= render DS::Alert.new(
          message: t(".alerts.due_soon_message", name: payment.recurring_bill.name, days: (payment.due_date - Date.current).to_i),
          variant: :warning
        ) %>
      <% end %>
    </div>
  <% end %>

  <div class="flex flex-col items-start gap-4 md:flex-row">
    <div class="w-full md:max-w-[400px]">
      <%= render "recurring_bills/calendar", month: @month, calendar_data: @calendar_data %>
    </div>

    <div class="w-full grow bg-container rounded-xl shadow-border-xs p-4" data-controller="bill-status-filter">
      <div class="flex items-center justify-between mb-4">
        <div class="flex items-center gap-2">
          <h2 class="text-lg font-medium"><%= t(".monthly_bills") %></h2>
          <%= link_to list_recurring_bills_path(month: @month), target: "_blank", class: "text-secondary hover:text-primary", title: t("recurring_bills.list_page.title") do %>
            <%= icon "external-link", size: "sm" %>
          <% end %>
        </div>
        <%= render DS::Link.new(
          text: t(".add_bill"),
          variant: "primary",
          icon: "plus",
          href: new_recurring_bill_path,
          frame: :modal
        ) %>
      </div>

      <div class="flex gap-1 mb-4 p-1 bg-container-inset rounded-lg">
        <button type="button" data-bill-status-filter-target="tab" data-status="all" data-action="click->bill-status-filter#select"
          class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors bg-container text-primary shadow-xs">
          <%= t(".filters.all") %>
        </button>
        <button type="button" data-bill-status-filter-target="tab" data-status="overdue_today" data-action="click->bill-status-filter#select"
          class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-secondary">
          <%= t(".filters.overdue_today") %>
        </button>
        <button type="button" data-bill-status-filter-target="tab" data-status="upcoming" data-action="click->bill-status-filter#select"
          class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-secondary">
          <%= t(".filters.upcoming") %>
        </button>
        <button type="button" data-bill-status-filter-target="tab" data-status="paid" data-action="click->bill-status-filter#select"
          class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-secondary">
          <%= t(".filters.paid") %>
        </button>
        <button type="button" data-bill-status-filter-target="tab" data-status="pending" data-action="click->bill-status-filter#select"
          class="px-3 py-1.5 text-sm font-medium rounded-md transition-colors text-secondary">
          <%= t(".filters.pending") %>
        </button>
      </div>

      <%= turbo_frame_tag "bill_payments_list" do %>
        <div class="bg-container-inset rounded-xl p-1 max-h-[400px] overflow-y-auto">
          <%= render "recurring_bills/list", bill_payments: @bill_payments %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="mt-6">
    <%= render "recurring_bills/cashflow_projection", projection: @cashflow_projection %>
  </div>
</div>
